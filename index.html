<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bahamas Store | Luxo & RP</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary: #FFD700;
            --bg-body: #14161a;
            --bg-card: #1f2229;
            --bg-input: #2a2e38;
            --text-main: #ffffff;
            --text-dim: #9ba3af;
        }

        body { background-color: var(--bg-body); color: var(--text-main); font-family: 'Montserrat', sans-serif; }

        /* --- UI ESTÉTICA --- */
        .navbar { background: var(--bg-card); border-bottom: 2px solid var(--primary); }
        .navbar-brand { font-weight: 800; color: var(--primary) !important; }

        /* Categorias Scroll */
        .category-scroll {
            display: flex; overflow-x: auto; gap: 12px; padding: 15px 0; scrollbar-width: none;
        }
        .category-scroll::-webkit-scrollbar { display: none; }
        .cat-card {
            min-width: 160px; height: 80px; background: var(--bg-card); border: 1px solid #333;
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; font-weight: 700; text-transform: uppercase;
            background-size: cover; background-position: center; position: relative; overflow: hidden;
        }
        .cat-card span { z-index: 2; text-shadow: 2px 2px 4px #000; }
        .cat-card.active { border-color: var(--primary); box-shadow: 0 0 10px rgba(255,215,0,0.3); }
        .cat-card::after { content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.5); }

        /* Produtos */
        .prod-card {
            background: var(--bg-card); border-radius: 12px; border: 1px solid #2d3139;
            overflow: hidden; transition: 0.3s; height: 100%;
        }
        .prod-card:hover { border-color: var(--primary); transform: translateY(-3px); }
        .price-tag { color: var(--primary); font-weight: 800; font-size: 1.2rem; }

        /* Chat */
        .chat-box {
            height: 350px; overflow-y: auto; background: #0d0e12; border-radius: 8px;
            padding: 15px; display: flex; flex-direction: column; gap: 10px;
        }
        .bubble { padding: 8px 15px; border-radius: 12px; max-width: 85%; font-size: 0.9rem; }
        .bubble.user { background: var(--primary); color: #000; align-self: flex-end; }
        .bubble.admin { background: #323742; color: #fff; align-self: flex-start; }
        .bubble.sys { background: rgba(255,255,255,0.05); color: var(--text-dim); align-self: center; font-size: 0.75rem; }

        /* Admin */
        .admin-section { display: none; }
        .admin-section.active { display: block; }
        .tab-btn { background: none; border: none; color: var(--text-dim); padding: 10px; font-weight: 600; width: 100%; text-align: left; }
        .tab-btn.active { color: var(--primary); border-left: 3px solid var(--primary); background: rgba(255,215,0,0.05); }

        .view { display: none; }
        .view.active { display: block; }

        .cart-btn {
            position: fixed; bottom: 25px; right: 25px; background: var(--primary);
            width: 55px; height: 55px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4); z-index: 100;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="showView('store')">BAHAMAS</a>
            <div class="ms-auto">
                <button class="btn btn-sm text-white" onclick="showView('tickets')">MEUS PEDIDOS</button>
                <button class="btn btn-sm btn-outline-warning ms-2" onclick="accessAdmin()">ADMIN</button>
            </div>
        </div>
    </nav>

    <div id="view-store" class="view active container py-4">
        <div class="category-scroll" id="cat-list"></div>
        
        <h4 class="fw-bold mb-3" id="cat-title">Todos os Produtos</h4>
        <div class="row g-3" id="prod-grid"></div>

        <div class="mt-5">
            <h5 class="text-primary fw-bold">Avaliações dos Clientes</h5>
            <div class="row g-3" id="reviews-grid"></div>
        </div>
    </div>

    <div id="view-tickets" class="view container py-5">
        <div class="row">
            <div class="col-md-4 mb-4">
                <h5 class="fw-bold mb-3">Histórico de Tickets</h5>
                <div id="ticket-list-user" class="list-group"></div>
            </div>
            <div class="col-md-8">
                <div id="chat-panel-user" class="card bg-card border-0 d-none">
                    <div class="card-header border-bottom border-secondary d-flex justify-content-between align-items-center">
                        <span id="chat-header-id" class="fw-bold"></span>
                        <span id="chat-header-status" class="badge bg-warning text-dark"></span>
                    </div>
                    <div class="card-body">
                        <div class="chat-box mb-3" id="chat-messages-user"></div>
                        <form onsubmit="sendMsgUser(event)" class="d-flex gap-2">
                            <input type="text" id="input-msg-user" class="form-control bg-input border-0 text-white" placeholder="Sua mensagem...">
                            <button class="btn btn-warning"><i class="fas fa-paper-plane"></i></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-admin" class="view container-fluid py-4">
        <div class="row px-lg-5">
            <div class="col-md-2">
                <div class="bg-card p-3 rounded">
                    <button class="tab-btn active" onclick="switchAdmin(this, 'adm-cats')">Categorias</button>
                    <button class="tab-btn" onclick="switchAdmin(this, 'adm-prods')">Produtos</button>
                    <button class="tab-btn" onclick="switchAdmin(this, 'adm-chats')">Atendimento</button>
                    <button class="tab-btn" onclick="switchAdmin(this, 'adm-coupons')">Cupons</button>
                    <button class="tab-btn" onclick="switchAdmin(this, 'adm-revs')">Avaliações</button>
                </div>
            </div>
            <div class="col-md-10">
                <div id="adm-cats" class="admin-tab">
                    <div class="bg-card p-4 rounded">
                        <h5 class="mb-3">Nova Categoria</h5>
                        <form onsubmit="addCat(event)" class="d-flex gap-2 mb-4">
                            <input type="text" id="ac-name" class="form-control bg-input border-0 text-white" placeholder="Nome" required>
                            <input type="text" id="ac-img" class="form-control bg-input border-0 text-white" placeholder="URL Imagem" required>
                            <button class="btn btn-warning">Criar</button>
                        </form>
                        <table class="table table-dark">
                            <tbody id="adm-cat-table"></tbody>
                        </table>
                    </div>
                </div>
                <div id="adm-prods" class="admin-tab d-none">
                    <div class="bg-card p-4 rounded">
                        <h5 class="mb-3">Novo Produto</h5>
                        <form onsubmit="addProd(event)" class="row g-2 mb-4">
                            <div class="col-md-3"><select id="ap-cat" class="form-select bg-input border-0 text-white"></select></div>
                            <div class="col-md-3"><input type="text" id="ap-name" class="form-control bg-input border-0 text-white" placeholder="Nome" required></div>
                            <div class="col-md-2"><input type="number" id="ap-price" class="form-control bg-input border-0 text-white" placeholder="Preço" required></div>
                            <div class="col-md-3"><input type="text" id="ap-img" class="form-control bg-input border-0 text-white" placeholder="URL Imagem" required></div>
                            <div class="col-md-1"><button class="btn btn-warning w-100">+</button></div>
                        </form>
                        <table class="table table-dark">
                            <tbody id="adm-prod-table"></tbody>
                        </table>
                    </div>
                </div>
                <div id="adm-chats" class="admin-tab d-none">
                    <div class="row">
                        <div class="col-md-4"><div id="adm-ticket-list" class="list-group"></div></div>
                        <div class="col-md-8">
                            <div id="chat-panel-admin" class="card bg-card border-0 d-none">
                                <div class="card-body">
                                    <div class="chat-box mb-3" id="chat-messages-admin"></div>
                                    <form onsubmit="sendMsgAdmin(event)" class="d-flex gap-2">
                                        <input type="text" id="input-msg-admin" class="form-control bg-input border-0 text-white" placeholder="Resposta...">
                                        <button class="btn btn-warning">Responder</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="cartModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-card text-white border-0">
                <div class="modal-header">
                    <h5 class="fw-bold">Carrinho</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="cart-render" class="mb-3"></div>
                    <div class="d-flex justify-content-between fw-bold border-top pt-3">
                        <span>Total:</span>
                        <span id="cart-total-val" class="text-primary">R$ 0,00</span>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button class="btn btn-warning w-100 fw-bold" onclick="checkout()">FINALIZAR COMPRA</button>
                </div>
            </div>
        </div>
    </div>

    <div class="cart-btn" onclick="openCart()">
        <i class="fas fa-shopping-basket"></i>
        <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.7rem;">0</span>
    </div>

    <script>
        // --- DATABASE ---
        let data = JSON.parse(localStorage.getItem('bahamas_v3')) || {
            cats: [{id: 1, name: "VIPs", img: "https://i.imgur.com/3QZ9Q0a.png"}],
            prods: [{id: 101, catId: 1, name: "VIP Ouro", price: 50, img: "https://via.placeholder.com/150"}],
            tickets: [],
            reviews: []
        };
        let cart = [];
        let activeTicket = null;

        function save() { localStorage.setItem('bahamas_v3', JSON.stringify(data)); }

        // --- NAVIGATION ---
        function showView(v) {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + v).classList.add('active');
            if(v === 'store') renderStore();
            if(v === 'tickets') renderUserTickets();
        }

        function switchAdmin(btn, tabId) {
            document.querySelectorAll('.admin-tab').forEach(el => el.classList.add('d-none'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.remove('d-none');
            btn.classList.add('active');
            if(tabId === 'adm-cats') renderAdminCats();
            if(tabId === 'adm-prods') renderAdminProds();
            if(tabId === 'adm-chats') renderAdminTickets();
        }

        function accessAdmin() {
            Swal.fire({ title: 'Acesso Restrito', input: 'password', background: '#1f2229', color: '#fff' }).then(r => {
                if(r.value === 'admin') showView('admin');
            });
        }

        // --- STORE ---
        function renderStore(catId = null) {
            const catList = document.getElementById('cat-list');
            catList.innerHTML = `<div class="cat-card ${!catId ? 'active' : ''}" onclick="renderStore(null)"><span>Todos</span></div>`;
            data.cats.forEach(c => {
                catList.innerHTML += `<div class="cat-card ${catId == c.id ? 'active' : ''}" onclick="renderStore(${c.id})" style="background-image:url('${c.img}')"><span>${c.name}</span></div>`;
            });

            const grid = document.getElementById('prod-grid');
            grid.innerHTML = '';
            const filtered = catId ? data.prods.filter(p => p.catId == catId) : data.prods;
            filtered.forEach(p => {
                grid.innerHTML += `
                    <div class="col-md-3">
                        <div class="prod-card">
                            <img src="${p.img}" class="w-100" style="height:150px; object-fit:cover">
                            <div class="p-3">
                                <div class="fw-bold text-truncate">${p.name}</div>
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <span class="price-tag">R$ ${p.price}</span>
                                    <button class="btn btn-sm btn-warning" onclick="addToCart(${p.id})"><i class="fas fa-cart-plus"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>`;
            });

            // Render Reviews
            const revGrid = document.getElementById('reviews-grid');
            revGrid.innerHTML = data.reviews.length ? '' : '<p class="text-dim">Nenhuma avaliação ainda.</p>';
            data.reviews.slice(-4).forEach(r => {
                revGrid.innerHTML += `<div class="col-md-3"><div class="bg-card p-3 rounded small border-start border-warning border-4">
                    <div class="text-warning mb-1">${'★'.repeat(r.stars)}</div>
                    <div class="text-white">"${r.comment}"</div>
                </div></div>`;
            });
        }

        // --- CARRINHO ---
        function addToCart(id) {
            const p = data.prods.find(x => x.id == id);
            cart.push({...p, cartId: Date.now()});
            document.getElementById('cart-badge').innerText = cart.length;
            Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: 'No carrinho', showConfirmButton: false, timer: 1000 });
        }

        function openCart() {
            const container = document.getElementById('cart-render');
            container.innerHTML = cart.length ? '' : '<p class="text-center text-dim">Carrinho vazio.</p>';
            let total = 0;
            cart.forEach(item => {
                total += parseFloat(item.price);
                container.innerHTML += `
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <img src="${item.img}" width="40" height="40" class="rounded">
                        <span class="flex-grow-1 ms-2 small">${item.name}</span>
                        <span class="fw-bold me-2">R$ ${item.price}</span>
                        <i class="fas fa-trash text-danger" onclick="removeFromCart(${item.cartId})" style="cursor:pointer"></i>
                    </div>`;
            });
            document.getElementById('cart-total-val').innerText = `R$ ${total.toFixed(2)}`;
            new bootstrap.Modal(document.getElementById('cartModal')).show();
        }

        function removeFromCart(cartId) {
            cart = cart.filter(i => i.cartId !== cartId);
            document.getElementById('cart-badge').innerText = cart.length;
            openCart();
        }

        function checkout() {
            if(!cart.length) return;
            const tId = Math.floor(1000 + Math.random() * 9000);
            const total = cart.reduce((a,b) => a + parseFloat(b.price), 0);
            const newTicket = {
                id: tId,
                total: total,
                status: 'aberto',
                msgs: [{sender: 'sys', text: `Pedido #${tId} criado. Itens: ${cart.map(i=>i.name).join(', ')}. Total: R$ ${total}`}]
            };
            data.tickets.push(newTicket);
            save();
            cart = [];
            document.getElementById('cart-badge').innerText = 0;
            bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();

            // MECANICA DE AVALIAÇÃO
            Swal.fire({
                title: 'Compra Finalizada!',
                text: 'Avalie sua experiência antes de ir para o ticket.',
                icon: 'success',
                input: 'select',
                inputOptions: { 5: '⭐⭐⭐⭐⭐ Perfeito', 4: '⭐⭐⭐⭐ Ótimo', 3: '⭐⭐⭐ Regular' },
                inputPlaceholder: 'Nota',
                showCancelButton: false,
                confirmButtonText: 'Avaliar'
            }).then(res => {
                const stars = res.value || 5;
                Swal.fire({ title: 'Deixe um comentário', input: 'text' }).then(com => {
                    data.reviews.push({ stars: stars, comment: com.value || "Sem comentário" });
                    save();
                    showView('tickets');
                });
            });
        }

        // --- TICKETS CLIENTE ---
        function renderUserTickets() {
            const list = document.getElementById('ticket-list-user');
            list.innerHTML = data.tickets.length ? '' : '<p class="text-dim">Nenhum pedido.</p>';
            data.tickets.forEach(t => {
                list.innerHTML += `<button onclick="openChatUser(${t.id})" class="list-group-item list-group-item-action bg-card text-white border-0 mb-2 rounded">
                    Ticket #${t.id} <span class="badge bg-warning text-dark float-end">R$ ${t.total}</span>
                </button>`;
            });
        }

        function openChatUser(id) {
            activeTicket = data.tickets.find(t => t.id == id);
            document.getElementById('chat-panel-user').classList.remove('d-none');
            document.getElementById('chat-header-id').innerText = `Pedido #${id}`;
            document.getElementById('chat-header-status').innerText = activeTicket.status;
            renderMsgs('chat-messages-user');
        }

        function sendMsgUser(e) {
            e.preventDefault();
            const input = document.getElementById('input-msg-user');
            if(!input.value) return;
            activeTicket.msgs.push({sender: 'user', text: input.value});
            save(); input.value = ''; renderMsgs('chat-messages-user');
        }

        // --- ADMIN LOGIC ---
        function renderAdminCats() {
            const table = document.getElementById('adm-cat-table');
            table.innerHTML = '';
            data.cats.forEach((c, idx) => {
                table.innerHTML += `<tr><td>${c.name}</td><td class="text-end"><button class="btn btn-sm btn-danger" onclick="data.cats.splice(${idx},1);save();renderAdminCats()">X</button></td></tr>`;
            });
        }
        function addCat(e) {
            e.preventDefault();
            data.cats.push({id: Date.now(), name: document.getElementById('ac-name').value, img: document.getElementById('ac-img').value});
            save(); renderAdminCats(); e.target.reset();
        }

        function renderAdminProds() {
            const table = document.getElementById('adm-prod-table');
            const select = document.getElementById('ap-cat');
            table.innerHTML = ''; select.innerHTML = '';
            data.cats.forEach(c => select.innerHTML += `<option value="${c.id}">${c.name}</option>`);
            data.prods.forEach((p, idx) => {
                table.innerHTML += `<tr><td>${p.name} (R$ ${p.price})</td><td class="text-end"><button class="btn btn-sm btn-danger" onclick="data.prods.splice(${idx},1);save();renderAdminProds()">X</button></td></tr>`;
            });
        }
        function addProd(e) {
            e.preventDefault();
            data.prods.push({id: Date.now(), catId: document.getElementById('ap-cat').value, name: document.getElementById('ap-name').value, price: document.getElementById('ap-price').value, img: document.getElementById('ap-img').value});
            save(); renderAdminProds(); e.target.reset();
        }

        function renderAdminTickets() {
            const list = document.getElementById('adm-ticket-list');
            list.innerHTML = '';
            data.tickets.forEach(t => {
                list.innerHTML += `<button onclick="openChatAdmin(${t.id})" class="list-group-item list-group-item-action bg-input text-white border-0 mb-1">Ticket #${t.id}</button>`;
            });
        }
        function openChatAdmin(id) {
            activeTicket = data.tickets.find(t => t.id == id);
            document.getElementById('chat-panel-admin').classList.remove('d-none');
            renderMsgs('chat-messages-admin');
        }
        function sendMsgAdmin(e) {
            e.preventDefault();
            const input = document.getElementById('input-msg-admin');
            activeTicket.msgs.push({sender: 'admin', text: input.value});
            save(); input.value = ''; renderMsgs('chat-messages-admin');
        }

        // --- UTILS ---
        function renderMsgs(containerId) {
            const box = document.getElementById(containerId);
            box.innerHTML = '';
            activeTicket.msgs.forEach(m => { box.innerHTML += `<div class="bubble ${m.sender}">${m.text}</div>`; });
            box.scrollTop = box.scrollHeight;
        }

        renderStore();
    </script>
</body>
</html>

