<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOJA DO RIO | VIP HUB</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --bg: #0a0a0a; --header: #111; --card: #151515; --accent: #00ff88; --text: #fff; --border: #222;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); background-attachment: fixed; background-size: cover; }
        
        /* HEADER & SEARCH */
        header { height: 65px; background: var(--header); display: flex; align-items: center; padding: 0 5%; border-bottom: 1px solid var(--border); position: fixed; top: 0; width: 100%; z-index: 1000; }
        .search-bar { flex: 1; max-width: 400px; margin: 0 20px; position: relative; }
        .search-bar input { width: 100%; background: #1a1a1a; border: 1px solid #333; padding: 8px 35px; border-radius: 8px; color: #fff; }
        .search-bar i { position: absolute; left: 10px; top: 10px; color: #555; }

        /* CATEGORIAS HORIZONTAL */
        .cat-scroll { display: flex; gap: 15px; overflow-x: auto; padding: 20px 5%; margin-top: 70px; scrollbar-width: none; }
        .cat-item { min-width: 140px; height: 180px; border-radius: 12px; position: relative; overflow: hidden; border: 1px solid var(--border); flex-shrink: 0; }
        .cat-item img { width: 100%; height: 100%; object-fit: cover; opacity: 0.4; }
        .cat-item span { position: absolute; bottom: 15px; width: 100%; text-align: center; font-weight: 800; font-size: 11px; text-transform: uppercase; }

        /* GRID PRODUTOS */
        .container { padding: 0 5% 50px; }
        .cat-title { font-size: 12px; color: #666; text-transform: uppercase; margin: 30px 0 15px; font-weight: 800; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding-bottom: 12px; }
        .p-img { width: 100%; height: 110px; object-fit: cover; }
        .btn-buy { width: 80%; background: #fff; border: none; padding: 8px; border-radius: 5px; font-weight: 800; cursor: pointer; }

        /* CHAT / TICKET NO SITE */
        .chat-box { position: fixed; bottom: 80px; right: 20px; width: 320px; background: #111; border: 1px solid var(--accent); border-radius: 10px; display: none; flex-direction: column; z-index: 2000; }
        .chat-msgs { height: 250px; overflow-y: auto; padding: 10px; font-size: 13px; }
        .chat-input { display: flex; border-top: 1px solid #222; }
        .chat-input input { flex: 1; background: transparent; border: none; color: #fff; padding: 10px; }
        
        /* ADMIN */
        #admin-view { display: none; padding: 80px 5%; }
        .admin-card { background: #111; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; }
        .ticket-row { display: flex; justify-content: space-between; padding: 10px; background: #1a1a1a; margin-bottom: 5px; border-radius: 5px; cursor: pointer; }

        .support-trigger { position: fixed; bottom: 20px; right: 20px; background: var(--accent); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #000; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <div style="font-weight:900">LOJA DO RIO</div>
    <div class="search-bar"><i class="fas fa-search"></i><input type="text" placeholder="Buscar..."></div>
    <button onclick="checkAdmin()" style="background:#222; color:#fff; border:none; padding:8px 15px; border-radius:5px; cursor:pointer">ADMIN</button>
</header>

<div id="user-view">
    <div class="cat-scroll" id="cat-list"></div>
    <div class="container" id="product-list"></div>
    
    <section class="container" style="text-align:center; margin-top:50px">
        <div class="cat-title">Avaliações</div>
        <div style="background:#111; padding:20px; border-radius:10px; border:1px solid #222">
            <div style="color:#f1c40f"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
            <p style="margin-top:10px">"O melhor preço do mercado, entrega automática via PIX!"</p>
        </div>
    </section>
</div>

<div id="admin-view">
    <h2 style="color:var(--accent); margin-bottom:20px">PAINEL DE CONTROLE</h2>
    <div class="admin-card">
        <h3>CADASTROS</h3>
        <input type="text" id="adm-p-name" placeholder="Nome Produto">
        <input type="number" id="adm-p-price" placeholder="Preço">
        <input type="text" id="adm-p-img" placeholder="URL Imagem">
        <input type="text" id="adm-p-cat" placeholder="Categoria">
        <button onclick="saveProd()" style="width:100%; padding:10px; background:var(--accent); border:none; border-radius:5px; font-weight:bold">SALVAR PRODUTO</button>
    </div>
    
    <div class="admin-card">
        <h3>TICKETS ATIVOS</h3>
        <div id="admin-tickets"></div>
    </div>
    
    <div class="admin-card">
        <h3>CONFIGURAÇÕES</h3>
        <input type="text" id="adm-bg" placeholder="URL Fundo do Site">
        <input type="text" id="adm-aviso" placeholder="Aviso da Loja">
        <button onclick="saveConfig()" style="width:100%; padding:10px; background:#444; color:#fff; border:none; border-radius:5px">ATUALIZAR LOJA</button>
    </div>
    <button onclick="location.reload()" style="color:#666; background:none; border:none; cursor:pointer">Sair do Painel</button>
</div>

<div class="chat-box" id="user-chat">
    <div style="padding:10px; background:var(--accent); color:#000; font-weight:bold; border-radius:10px 10px 0 0">SUPORTE ONLINE</div>
    <div class="chat-msgs" id="chat-content"></div>
    <div class="chat-input">
        <input type="text" id="msg-input" placeholder="Diga algo...">
        <button onclick="sendMsg('user')" style="padding:10px; background:none; border:none; color:var(--accent)"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<div class="support-trigger" onclick="toggleChat()"><i class="fas fa-comments"></i></div>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyCYzx7TPmAghFcGuKYzBDIYRW0SjrMJ_r8", 
        databaseURL: "https://quebrei-o-sistema-default-rtdb.firebaseio.com", 
        projectId: "quebrei-o-sistema" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const myId = localStorage.getItem('chat_id') || 'cli_' + Math.floor(Math.random()*9999);
    localStorage.setItem('chat_id', myId);

    function checkAdmin() {
        if(prompt("Senha Mestra:") === "270712") {
            document.getElementById('user-view').style.display='none';
            document.getElementById('admin-view').style.display='block';
            loadAdminTickets();
        }
    }

    function toggleChat() { 
        const c = document.getElementById('user-chat');
        c.style.display = c.style.display === 'flex' ? 'none' : 'flex';
    }

    // CARREGAR DADOS
    db.ref('/').on('value', snap => {
        const data = snap.val() || {};
        renderStore(data.produtos, data.categorias);
        if(data.config) document.body.style.backgroundImage = `url(${data.config.bg})`;
    });

    function renderStore(prods, cats) {
        const pList = document.getElementById('product-list');
        const cList = document.getElementById('cat-list');
        pList.innerHTML = ""; cList.innerHTML = "";

        // Categorias Horizontais
        for(let id in cats) {
            cList.innerHTML += `<div class="cat-item"><img src="${cats[id].img}"><span>${cats[id].name}</span></div>`;
        }

        // Produtos em Grid
        for(let id in prods) {
            pList.innerHTML += `
                <div class="cat-title">${prods[id].cat}</div>
                <div class="grid">
                    <div class="card">
                        <img src="${prods[id].img}" class="p-img">
                        <div style="padding:10px">
                            <div style="font-size:13px">${prods[id].name}</div>
                            <div style="font-weight:bold; margin:5px 0">R$ ${prods[id].price}</div>
                            <button class="btn-buy">COMPRAR</button>
                        </div>
                    </div>
                </div>`;
        }
    }

    // SUPORTE / TICKET
    function sendMsg(role, id = myId) {
        const input = document.getElementById(role === 'user' ? 'msg-input' : 'adm-msg-'+id);
        if(!input.value) return;
        db.ref('tickets/' + id + '/chat').push({ role: role, text: input.value, time: Date.now() });
        input.value = "";
    }

    db.ref('tickets/' + myId + '/chat').on('value', snap => {
        const cont = document.getElementById('chat-content');
        cont.innerHTML = "";
        snap.forEach(m => {
            const msg = m.val();
            cont.innerHTML += `<div style="margin-bottom:8px; color:${msg.role==='user'?'#fff':var(--accent)}"><b>${msg.role.toUpperCase()}:</b> ${msg.text}</div>`;
        });
        cont.scrollTop = cont.scrollHeight;
    });

    // ADMIN FUNCTIONS
    function saveProd() {
        const name = document.getElementById('adm-p-name').value;
        const price = document.getElementById('adm-p-price').value;
        const img = document.getElementById('adm-p-img').value;
        const cat = document.getElementById('adm-p-cat').value;
        db.ref('produtos').push({name, price, img, cat});
    }

    function loadAdminTickets() {
        db.ref('tickets').on('value', snap => {
            const cont = document.getElementById('admin-tickets');
            cont.innerHTML = "";
            snap.forEach(t => {
                cont.innerHTML += `
                    <div class="ticket-row">
                        <span>Ticket: ${t.key}</span>
                        <input type="text" id="adm-msg-${t.key}" placeholder="Responder..." style="width:50%; margin:0">
                        <button onclick="sendMsg('admin', '${t.key}')" style="background:var(--accent); border:none; padding:5px 10px; border-radius:3px">Enviar</button>
                    </div>`;
            });
        });
    }
</script>
</body>
</html>
