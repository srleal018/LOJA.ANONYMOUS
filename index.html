<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bahamas Store | Luxo & Entrega Rápida</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root { --primary: #FFD700; --bg-body: #0d0f12; --bg-card: #16191f; --text-main: #ffffff; }
        body { background-color: var(--bg-body); color: var(--text-main); font-family: 'Montserrat', sans-serif; }
        
        .navbar { background: var(--bg-card); border-bottom: 2px solid var(--primary); }
        .navbar-brand { font-weight: 900; color: var(--primary) !important; letter-spacing: 1px; }

        .view { display: none; }
        .view.active { display: block; }

        /* Categorias Estilo Filtro */
        .cat-filter-container { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; }
        .cat-filter-container::-webkit-scrollbar { display: none; }
        .cat-btn-filter { 
            background: #1f232b; color: white; border: 1px solid #333; padding: 8px 20px; 
            border-radius: 50px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600;
        }
        .cat-btn-filter.active { background: var(--primary); color: #000; border-color: var(--primary); }

        /* Card de Produto */
        .prod-card { background: var(--bg-card); border-radius: 12px; border: 1px solid #2d3139; overflow: hidden; transition: 0.3s; }
        .prod-card:hover { border-color: var(--primary); transform: translateY(-3px); }
        
        /* Sistema de Chat do Ticket */
        .chat-window { background: #090a0c; border-radius: 10px; height: 350px; display: flex; flex-direction: column; }
        .chat-messages { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .chat-input-area { padding: 10px; background: #16191f; border-top: 1px solid #333; display: flex; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 75%; font-size: 0.85rem; position: relative; }
        .msg.admin { background: var(--primary); color: #000; align-self: flex-start; border-bottom-left-radius: 2px; }
        .msg.user { background: #323742; color: #fff; align-self: flex-end; border-bottom-right-radius: 2px; }
        .msg-info { font-size: 0.65rem; display: block; margin-top: 5px; opacity: 0.7; }

        /* Rodapé */
        footer { background: #08090b; padding: 40px 0; border-top: 2px solid var(--primary); margin-top: 60px; }
        
        /* Carrinho Flutuante */
        .cart-btn {
            position: fixed; bottom: 30px; right: 30px; background: var(--primary);
            width: 60px; height: 60px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer;
            z-index: 1000; color: #000; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="showView('store')">BAHAMAS STORE</a>
            <div class="ms-auto d-flex gap-2">
                <button class="btn btn-outline-light btn-sm" onclick="showView('tickets')">MEUS PEDIDOS</button>
                <button class="btn btn-warning btn-sm fw-bold" onclick="accessAdmin()">ADMIN</button>
            </div>
        </div>
    </nav>

    <div id="view-store" class="view active container py-4">
        <h6 class="text-secondary fw-bold text-uppercase small mb-3">Categorias</h6>
        <div class="cat-filter-container mb-4" id="cat-tabs-render"></div>
        
        <h5 class="fw-bold mb-3">Produtos</h5>
        <div class="row g-3" id="prod-grid"></div>
    </div>

    <div id="view-tickets" class="view container py-5">
        <h4 class="fw-bold mb-4 text-primary">Meus Pedidos & Suporte</h4>
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="list-group" id="user-orders-list"></div>
            </div>
            <div class="col-md-8">
                <div id="active-chat-container" class="d-none">
                    <div class="chat-window shadow">
                        <div class="p-3 border-bottom border-secondary d-flex justify-content-between align-items-center">
                            <span id="chat-title" class="fw-bold text-primary">Ticket #0000</span>
                            <span class="badge bg-warning text-dark" id="chat-status">Pendente</span>
                        </div>
                        <div class="chat-messages" id="chat-messages"></div>
                        <div class="chat-input-area">
                            <input type="text" id="chat-input" class="form-control bg-dark text-white border-0" placeholder="Escreva sua mensagem ou cole link do comprovante...">
                            <button class="btn btn-warning" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
                <div id="no-chat-selected" class="text-center py-5 bg-card rounded border border-secondary border-dashed">
                    <p class="text-secondary">Selecione um pedido ao lado para abrir o ticket de entrega.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="view-admin" class="view container py-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="text-warning fw-bold">Painel de Gestão</h4>
            <button class="btn btn-danger btn-sm" onclick="showView('store')">Sair</button>
        </div>
        <div class="row">
            <div class="col-md-4">
                <div class="bg-card p-3 rounded mb-3">
                    <h6>Nova Categoria</h6>
                    <div class="input-group"><input type="text" id="adm-cat-in" class="form-control bg-dark text-white border-secondary"><button class="btn btn-warning" onclick="addCat()">+</button></div>
                </div>
                <div class="bg-card p-3 rounded">
                    <h6>Novo Produto</h6>
                    <input type="text" id="adm-p-name" class="form-control mb-2 bg-dark text-white" placeholder="Nome">
                    <input type="number" id="adm-p-price" class="form-control mb-2 bg-dark text-white" placeholder="Preço">
                    <select id="adm-p-cat" class="form-select mb-2 bg-dark text-white"></select>
                    <input type="text" id="adm-p-img" class="form-control mb-2 bg-dark text-white" placeholder="URL Imagem">
                    <button class="btn btn-warning w-100 fw-bold" onclick="addProd()">CADASTRAR</button>
                </div>
            </div>
            <div class="col-md-8">
                <div class="bg-card p-3 rounded">
                    <h6 class="mb-3">Tickets Ativos (Responder Clientes)</h6>
                    <div id="adm-tickets-render"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="cartModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-card text-white border-0">
                <div class="modal-header border-secondary">
                    <h5 class="fw-bold text-primary">Carrinho</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="cart-items"></div>
                    <div class="p-3 bg-dark rounded mt-3 d-flex justify-content-between align-items-center">
                        <div>
                            <span class="d-block small text-secondary">Total via PIX:</span>
                            <h4 class="text-primary fw-bold mb-0" id="cart-total">R$ 0,00</h4>
                        </div>
                        <button class="btn btn-warning fw-bold" onclick="finalizeOrder()">FINALIZAR</button>
                    </div>
                    <p class="text-center small text-secondary mt-3">Entrega garantida em menos de 24h.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="cart-btn" onclick="openCart()"><i class="fas fa-shopping-cart"></i><span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span></div>

    <footer>
        <div class="container text-center">
            <h5 class="text-primary fw-bold mb-2">BAHAMAS STORE</h5>
            <p class="small text-secondary mb-4">Entrega digital rápida, 100% confiável e pagamento via PIX.</p>
            <div class="d-flex justify-content-center gap-3">
                <span class="small text-white-50"><i class="fas fa-check-circle text-success"></i> 100% Confiável</span>
                <span class="small text-white-50"><i class="fas fa-bolt text-warning"></i> Entrega < 24h</span>
            </div>
            <p class="small text-secondary mt-4 mb-0">© 2024 Bahamas Store</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let db = JSON.parse(localStorage.getItem('bahamas_final_v5')) || {
            cats: ["VIPs", "Carros", "Itens"],
            products: [],
            orders: []
        };
        let cart = [];
        let currentChatId = null;
        let isAdminView = false;

        function save() { 
            localStorage.setItem('bahamas_final_v5', JSON.stringify(db)); 
            renderStore();
            renderAdmin();
        }

        function showView(v) {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + v).classList.add('active');
            isAdminView = (v === 'admin');
            if(v === 'tickets') renderUserOrders();
        }

        function accessAdmin() {
            Swal.fire({ title: 'Senha Admin', input: 'password', background: '#16191f', color: '#fff', confirmButtonColor: '#FFD700' }).then(r => {
                if(r.value === '2707') showView('admin');
            });
        }

        // --- LÓGICA DE CATEGORIAS E PRODUTOS ---
        function addCat() {
            const v = document.getElementById('adm-cat-in').value;
            if(v) { db.cats.push(v); document.getElementById('adm-cat-in').value = ''; save(); }
        }

        function addProd() {
            const n = document.getElementById('adm-p-name').value;
            const p = document.getElementById('adm-p-price').value;
            const c = document.getElementById('adm-p-cat').value;
            const i = document.getElementById('adm-p-img').value;
            if(n && p) {
                db.products.push({ id: Date.now(), name: n, price: p, cat: c, img: i || 'https://via.placeholder.com/200' });
                save();
            }
        }

        function renderStore(filter = 'Todos') {
            // Renderizar Abas de Categorias encima
            const tabs = document.getElementById('cat-tabs-render');
            tabs.innerHTML = `<div class="cat-btn-filter ${filter==='Todos'?'active':''}" onclick="renderStore('Todos')">Todos</div>`;
            db.cats.forEach(c => {
                tabs.innerHTML += `<div class="cat-btn-filter ${filter===c?'active':''}" onclick="renderStore('${c}')">${c}</div>`;
            });

            // Renderizar Produtos
            const grid = document.getElementById('prod-grid');
            const filtered = filter === 'Todos' ? db.products : db.products.filter(p => p.cat === filter);
            grid.innerHTML = filtered.map(p => `
                <div class="col-6 col-md-4">
                    <div class="prod-card">
                        <img src="${p.img}" class="w-100" style="height:140px; object-fit:cover">
                        <div class="p-3">
                            <h6 class="fw-bold mb-1">${p.name}</h6>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-primary fw-bold">R$ ${p.price}</span>
                                <button class="btn btn-sm btn-warning" onclick="addToCart(${p.id})">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- CARRINHO ---
        function addToCart(id) {
            const p = db.products.find(x => x.id === id);
            cart.push({...p, cartId: Date.now()});
            document.getElementById('cart-badge').innerText = cart.length;
            Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: 'No carrinho', showConfirmButton: false, timer: 1000 });
        }

        function openCart() {
            const list = document.getElementById('cart-items');
            let total = 0;
            list.innerHTML = cart.map(i => {
                total += parseFloat(i.price);
                return `<div class="d-flex justify-content-between border-bottom border-secondary py-2"><span>${i.name}</span><b>R$ ${i.price}</b></div>`;
            }).join('');
            document.getElementById('cart-total').innerText = `R$ ${total.toFixed(2)}`;
            new bootstrap.Modal(document.getElementById('cartModal')).show();
        }

        function finalizeOrder() {
            if(!cart.length) return;
            const orderId = Math.floor(1000 + Math.random() * 8999);
            const newOrder = {
                id: orderId,
                total: cart.reduce((a,b) => a + parseFloat(b.price), 0).toFixed(2),
                status: 'Aguardando Pagamento',
                messages: [{ sender: 'admin', text: 'Olá! Efetue o PIX e envie o comprovante aqui para entregarmos seu pedido.', time: new Date().toLocaleTimeString() }]
            };
            db.orders.push(newOrder);
            cart = [];
            document.getElementById('cart-badge').innerText = 0;
            save();
            bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
            showView('tickets');
            openChat(orderId);
        }

        // --- SISTEMA DE CHAT / TICKETS ---
        function renderUserOrders() {
            const list = document.getElementById('user-orders-list');
            list.innerHTML = db.orders.map(o => `
                <button onclick="openChat(${o.id})" class="list-group-item list-group-item-action bg-card text-white border-secondary mb-2 rounded">
                    Pedido #${o.id} <br><small class="text-warning">${o.status}</small>
                </button>
            `).join('');
        }

        function openChat(id) {
            currentChatId = id;
            isAdminView = (document.getElementById('view-admin').classList.contains('active'));
            const order = db.orders.find(o => o.id === id);
            document.getElementById('active-chat-container').classList.remove('d-none');
            if(!isAdminView) document.getElementById('no-chat-selected').classList.add('d-none');
            
            document.getElementById('chat-title').innerText = `Ticket #${order.id}`;
            document.getElementById('chat-status').innerText = order.status;
            
            const msgBox = document.getElementById(isAdminView ? 'adm-chat-messages' : 'chat-messages');
            msgBox.innerHTML = order.messages.map(m => `
                <div class="msg ${m.sender}">
                    ${m.text}
                    <span class="msg-info">${m.time}</span>
                </div>
            `).join('');
            msgBox.scrollTop = msgBox.scrollHeight;
        }

        function sendMessage() {
            const inputId = isAdminView ? 'adm-chat-input' : 'chat-input';
            const input = document.getElementById(inputId);
            if(!input.value || !currentChatId) return;

            const order = db.orders.find(o => o.id === currentChatId);
            order.messages.push({
                sender: isAdminView ? 'admin' : 'user',
                text: input.value,
                time: new Date().toLocaleTimeString()
            });
            input.value = '';
            save();
            openChat(currentChatId);
        }

        function renderAdmin() {
            document.getElementById('adm-p-cat').innerHTML = db.cats.map(c => `<option value="${c}">${c}</option>`).join('');
            const ticketsRender = document.getElementById('adm-tickets-render');
            ticketsRender.innerHTML = db.orders.map(o => `
                <div class="bg-dark p-3 rounded mb-3 border border-secondary">
                    <div class="d-flex justify-content-between">
                        <b>Ticket #${o.id} (R$ ${o.total})</b>
                        <select onchange="updateStatus(${o.id}, this.value)" class="bg-warning text-dark border-0 rounded px-2">
                            <option ${o.status==='Aguardando Pagamento'?'selected':''}>Aguardando Pagamento</option>
                            <option ${o.status==='Entregue'?'selected':''}>Entregue</option>
                        </select>
                    </div>
                    <div class="chat-window mt-2" style="height: 200px;">
                        <div class="chat-messages" id="chat-messages-adm-${o.id}" style="font-size: 0.8rem;">
                            ${o.messages.map(m => `<div class="msg ${m.sender}">${m.text}</div>`).join('')}
                        </div>
                    </div>
                    <div class="input-group mt-2">
                        <input type="text" id="input-adm-${o.id}" class="form-control form-control-sm bg-dark text-white border-secondary" placeholder="Responder cliente...">
                        <button class="btn btn-sm btn-warning" onclick="adminReply(${o.id})">Enviar</button>
                    </div>
                </div>
            `).join('');
        }

        function adminReply(id) {
            const input = document.getElementById(`input-adm-${id}`);
            if(!input.value) return;
            const order = db.orders.find(o => o.id === id);
            order.messages.push({ sender: 'admin', text: input.value, time: new Date().toLocaleTimeString() });
            input.value = '';
            save();
        }

        function updateStatus(id, s) {
            db.orders.find(o => o.id === id).status = s;
            save();
        }

        // Iniciar
        renderStore();
    </script>
</body>
</html>
